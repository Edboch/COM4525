-# Admin Team Card
-# HAML for a team card in the admin page
-#
-# @param [ActiveRecord] team - The team to be rendered

.team-card{ id: "team-card-#{team.id}", data: { id: team.id } }
  .tc-pill
    %h2.team-name= team.name
    %h4.owner-name= "Owner: #{team.owner.name}"

  .tc-body
    .tc-owner
      %h4= team.owner.name
      = render(partial: 'snippets/live_search',
               locals: { name: 'owner', field_label: 'New Owner',
                         placeholder: 'Owner Name or Email',
                         search_data_var: 'users',
                         search_fields: [ 'name', 'email' ],
                         other_data: { team_id: team.id, owner_id: team.owner.id } })

    .tc-new-member
      %h5 New Member
      %form
        - user_ids = team.user_teams.pluck :user_id
        = render(partial: 'snippets/live_search',
                 locals: { name: 'team-new-member',
                           placeholder: 'Member Name or Email',
                           search_data_var: 'users',
                           search_fields: [ 'name', 'email' ],
                           other_data: { member_ids: user_ids }})

        .roles-context
          = render(partial: 'snippets/live_search',
                   locals: { name: 'nm-team-role', field_label: 'Team Role',
                             search_data_var: 'team_roles',
                             search_fields: [ 'name' ], other_data: { roles: [] } })
          .role-list

        %button.add Add

    .tc-member-list
      - team.user_teams.each do |member|
        - role_ids = member.roles.pluck :id
        .tc-member{ id: "user-team-#{member.id}", data: { id: member.id, role_ids: role_ids } }
          .tcm-pill
            %button.tcm-delete Delete
            %h5.tcm-name
              %span= member.user.name
            .tcm-roles
              %span= member.roles.pluck(:name).join ' | '

          .tcm-body
            .head
              %button.tcm-delete Delete
              %h5.tcm-name
                %span= member.user.name

            = render(partial: 'snippets/live_search',
                     locals: { name: "tm-team-role", placeholder: 'New Role',
                               search_data_var: 'team_roles',
                               search_fields: [ 'name' ] })

            .tcm-roles
              - member.roles.decorate.each do |role|
                %span.tcm-team-role
                  %button.tr-remove{ data: { user_team_id: member.id, role_id: role.id } } Remove
                  %span= role.name
                  %span= role.type_name
